{% extends 'base.html'%}
{% block content %}
    <meta id="curr_user" content="{{ sess }}">
    
    <a href="/logout" style="float:right">Log Out</a>
    {% if matches|length %}
    <h2>Your Buddies:</h2>
    {% for user in matches %}
 
        <h4>{{ matches[user][0] }} <button class='user-id' target='{{ user }}'><img src="http://www.myiconfinder.com/uploads/iconsets/256-256-f269bbc2a3bd8805b0dccb6c36dd2fac.png" width="16" height="16"></button></h4> 

        {% if matches[user][1] %}
            <i>Interests: {{ matches[user][0] }}</i>
            <br>
        {% endif %}

        </form>
        Restaurant: {{ matches[user][2]['rest_title'] }}
        <br>
        Rating: {{ matches[user][2]['rating'] }}
        <br>
        Number of Reviews: {{ matches[user][2]['num_reviews'] }}
        <br>
        Address: {{ matches[user][2]['address'] }}
        <br>
        Phone: <a href="tel:{{ matches[user][2]['phone'] }}">{{ matches[user][2]['phone'] }}</a> 
        
        <br><br>

    {% endfor %}
    
        <h2>Messages</h2>
        <div id="log"></div>

        <form id="send_room" class="mess" method="POST" action='#'>
            <input type="text" name="room_name" id="room_name" value='3'>
            <input type="text" name="room_data" id="room_data" placeholder="Message">
            <input type="submit" value="Send">
        </form>

    {% else %}
        <h3>I didn't find a buddy today.</h3>
    {% endif %}

    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
          // namespace are set to a route string since multiple channels are needed
          namespace='/munchbuddies';

          // connect to the SOCKET.IO server.
          // URL format
          let socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

          // socket.on use to define event handler

          // event handler for server sent data
          // Callback function is invoked whenever the server emits data to the client. 
          // data will be displayed in the Receive section of the page
            socket.on('my_response', function(msg) {
                $('#log').append('<p>{{ sess }}: ' + msg.data + '</p>');
   
          });
          //Handlers for the different forms in the page
         // Accepts data from the user and send it to the server in a different ways 
            socket.emit('join', {room: $('#curr_user').attr('content')});
           $('.user-id').click(function(event){
            console.log('now working')
            console.log($(this).attr('target'));
            socket.emit('join', {room: $(this).attr('target')});
           })
            $('form.mess').submit(function(event) {
                socket.emit('my_room_event', {room: $('#room_name').val(), data: $('#room_data').val()});
                socket.emit('my_event', {data: $('#room_data').val()})
                return false;
            });
           $('form#disconnect').submit(function(event) {
              socket.emit('disconnect_request');
              return false;
           });
        });
    </script>

{% endblock %}
